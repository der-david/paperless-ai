<!DOCTYPE html>
<html lang="en" class="h-full" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paperless-ai Setup</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/setup.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/css/shepherd.css"/>
    <script src="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/js/shepherd.min.js"></script>
</head>
<body class="h-full">
    <button id="themeToggle" class="theme-toggle material-button-2">
        <i class="fas fa-moon dark:fas fa-sun"></i>
    </button>

    <div class="min-h-full">
        <nav class="modern-nav">
            <div class="mx-auto max-w-7xl px-6 lg:px-8">
                <div class="flex h-24 items-center justify-between">
                    <div class="flex items-center space-x-6">
                        <img src="/favicon.ico" alt="Paperless AI Logo" class="app-logo">
                        <div>
                            <h1 class="text-2xl font-bold">Paperless-AI <small><%= config.PAPERLESS_AI_VERSION %></small></h1>
                            <p class="text-sm text-secondary">Configuration Setup</p>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="py-10">
            <div class="mx-auto max-w-3xl px-6 lg:px-8">
                <!-- Progress Bar -->
                <div class="mb-6">
                    <div class="progress-bar">
                        <div class="progress-bar-fill"></div>
                    </div>
                </div>

                <!-- Main Form Card -->
                <div class="material-card">
                    <!-- Tab Navigation -->
                    <div class="tab-navigation border-b border-gray-200 mb-6">
                        <nav class="flex flex-wrap gap-2" role="tablist">
                            <button type="button"
                                    class="tab-button active flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2"
                                    data-tab="user-tab">
                                <i class="fas fa-user"></i>
                                User Setup
                            </button>
                            <button type="button"
                                    class="tab-button flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2"
                                    data-tab="connection-tab">
                                <i class="fas fa-link"></i>
                                Connection
                            </button>
                            <button type="button"
                                    class="tab-button flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2"
                                    data-tab="ai-tab">
                                <i class="fas fa-robot"></i>
                                AI Settings
                            </button>
                            <button type="button"
                                    class="tab-button flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2"
                                    data-tab="advanced-tab">
                                <i class="fas fa-cog"></i>
                                Advanced
                            </button>
                        </nav>
                    </div>

                    <form id="setupForm" class="space-y-12">
                        <!-- User Settings Tab -->
                        <div id="user-tab" class="tab-content active">
                            <section>
                                <h2 class="section-title">
                                    <i class="fas fa-user"></i>
                                    User Settings
                                </h2>
                                <div class="space-y-6">
                                    <!-- User settings content -->
                                    <div class="form-group">
                                        <label for="username">Username</label>
                                        <input type="text"
                                               id="username"
                                               name="username"
                                               class="modern-input"
                                               required>
                                    </div>

                                    <div class="form-group">
                                        <label for="password">Password</label>
                                        <div class="password-input">
                                            <input type="password"
                                                   id="password"
                                                   name="password"
                                                   class="modern-input"
                                                   required>
                                            <button type="button" class="password-toggle" data-input="password">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div id="password-strength" class="mt-2"></div>
                                    </div>

                                    <div class="form-group">
                                        <label for="confirmPassword">Confirm Password</label>
                                        <div class="password-input">
                                            <input type="password"
                                                   id="confirmPassword"
                                                   name="confirmPassword"
                                                   class="modern-input"
                                                   required>
                                            <button type="button" class="password-toggle" data-input="confirmPassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div id="password-match" class="mt-2"></div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Connection Settings Tab -->
                        <div id="connection-tab" class="tab-content hidden">
                            <section>
                                <h2 class="section-title">
                                    <i class="fas fa-link"></i>
                                    Connection Settings
                                </h2>
                                <div class="space-y-6">
                                    <!-- Connection settings content -->
                                    <div class="form-group">
                                        <label for="paperlessUrl" class="flex items-center gap-2">
                                            Paperless-ngx API URL
                                            <button type="button"
                                                    class="help-btn text-gray-400 hover:text-gray-600 focus:outline-none"
                                                    id="urlHelp">
                                                <i class="fas fa-circle-question"></i>
                                            </button>
                                        </label>
                                        <input type="text"
                                               id="paperlessUrl"
                                               name="paperlessUrl"
                                               value="<%= config.PAPERLESS_API_URL %>"
                                               class="modern-input"
                                               placeholder="http://your-paperless-instance:8000"
                                               required>
                                    </div>

                                    <div class="form-group">
                                        <label for="paperlessToken">API Token</label>
                                        <div class="password-input">
                                            <input type="password"
                                                   id="paperlessToken"
                                                   name="paperlessToken"
                                                   value="<%= config.PAPERLESS_API_TOKEN %>"
                                                   class="modern-input"
                                                   required>
                                            <button type="button" class="password-toggle" data-input="paperlessToken">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="paperlessUsername">Paperless-ngx Username</label>
                                        <input type="text"
                                               id="paperlessUsername"
                                               name="paperlessUsername"
                                               value="<%= config.PAPERLESS_USERNAME %>"
                                               class="modern-input"
                                               required>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- AI Settings Tab -->
                        <div id="ai-tab" class="tab-content hidden">
                            <section>
                                <h2 class="section-title">
                                    <i class="fas fa-robot"></i>
                                    AI Configuration
                                </h2>
                                <div class="space-y-6">
                                    <!-- AI Provider Selection -->
                                    <div class="form-group">
                                        <label for="aiProvider">AI Provider</label>
                                        <select id="aiProvider"
                                                name="aiProvider"
                                                class="modern-input">
                                            <option value="openai" <%= config.AI_PROVIDER === 'openai' ? 'selected' : '' %>>
                                                OpenAI (ChatGPT)
                                            </option>
                                            <option value="ollama" <%= config.AI_PROVIDER === 'ollama' ? 'selected' : '' %>>
                                                Ollama (Local LLM)
                                            </option>
                                            <option value="custom" <%= config.AI_PROVIDER === 'custom' ? 'selected' : '' %>>
                                                Custom
                                            </option>
                                            <option value="azure" <%= config.AI_PROVIDER === 'azure' ? 'selected' : '' %>>
                                                Azure
                                            </option>
                                        </select>
                                    </div>

                                    <!-- OpenAI Settings -->
                                    <div id="openaiSettings" class="provider-settings">
                                        <div class="form-group">
                                            <label for="openaiKey">OpenAI API Key</label>
                                            <div class="password-input">
                                                <input type="password"
                                                       id="openaiKey"
                                                       name="openaiKey"
                                                       value="<%= config.OPENAI_API_KEY %>"
                                                       class="modern-input">
                                                <button type="button" class="password-toggle" data-input="openaiKey">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="openaiModel">OpenAI Model</label>
                                            <select id="openaiModel"
                                                    name="openaiModel"
                                                    class="modern-input">
                                                <option value="gpt-5.2" <%= config.OPENAI_MODEL === 'gpt-5.2' ? 'selected' : '' %>>GPT-5.2</option>
                                                <option value="gpt-5.1" <%= config.OPENAI_MODEL === 'gpt-5.1' ? 'selected' : '' %>>GPT-5.1</option>
                                                <option value="gpt-5" <%= config.OPENAI_MODEL === 'gpt-5' ? 'selected' : '' %>>GPT-5</option>
                                                <option value="gpt-5-mini" <%= config.OPENAI_MODEL === 'gpt-5-mini' ? 'selected' : '' %>>GPT-5 mini</option>
                                                <option value="gpt-5-nano" <%= config.OPENAI_MODEL === 'gpt-5-nano' ? 'selected' : '' %>>GPT-5 nano</option>
                                                <option value="gpt-4.1" <%= config.OPENAI_MODEL === 'gpt-4.1' ? 'selected' : '' %>>GPT-4.1</option>
                                                <option value="gpt-4.1-mini" <%= config.OPENAI_MODEL === 'gpt-4.1-mini' ? 'selected' : '' %>>GPT-4.1 mini</option>
                                                <option value="gpt-4.1-nano" <%= config.OPENAI_MODEL === 'gpt-4.1-nano' ? 'selected' : '' %>>GPT-4.1 nano</option>
                                                <option value="gpt-4o" <%= config.OPENAI_MODEL === 'gpt-4o' ? 'selected' : '' %>>GPT-4o</option>
                                                <option value="gpt-4o-mini" <%= config.OPENAI_MODEL === 'gpt-4o-mini' ? 'selected' : '' %>>GPT-4o mini</option>
                                                <option value="o3" <%= config.OPENAI_MODEL === 'o3' ? 'selected' : '' %>>o3</option>
                                                <option value="o3-mini" <%= config.OPENAI_MODEL === 'o3-mini' ? 'selected' : '' %>>o3-mini</option>
                                                <option value="o4-mini" <%= config.OPENAI_MODEL === 'o4-mini' ? 'selected' : '' %>>o4-mini</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="openaiGizmoId">Gizmo ID (Custom GPT)</label>
                                            <input type="text"
                                                   id="openaiGizmoId"
                                                   name="openaiGizmoId"
                                                   value="<%= config.OPENAI_GIZMO_ID %>"
                                                   class="modern-input"
                                                   placeholder="g-697d35206a2121a4bda4c4c01ddfbcd3">
                                        </div>
                                    </div>

                                    <!-- Ollama Settings -->
                                    <div id="ollamaSettings" class="provider-settings">
                                        <div class="form-group">
                                            <label for="ollamaUrl">Ollama API URL</label>
                                            <input type="text"
                                                   id="ollamaUrl"
                                                   name="ollamaUrl"
                                                   value="<%= config.OLLAMA_API_URL %>"
                                                   class="modern-input">
                                        </div>

                                        <div class="form-group">
                                            <label for="ollamaModel">Ollama Model</label>
                                            <input type="text"
                                                   id="ollamaModel"
                                                   name="ollamaModel"
                                                   value="<%= config.OLLAMA_MODEL %>"
                                                   class="modern-input">
                                        </div>
                                    </div>

                                    <!-- Custom Provider Settings -->
                                    <div id="customSettings" class="provider-settings">
                                        <div class="form-group">
                                            <label for="customBaseUrl">Base URL</label>
                                            <input type="text"
                                                   id="customBaseUrl"
                                                   name="customBaseUrl"
                                                   value="<%= config.CUSTOM_BASE_URL %>"
                                                   class="modern-input"
                                                   placeholder="https://api.example.com">
                                        </div>

                                        <div class="form-group">
                                            <label for="customApiKey">API Key</label>
                                            <div class="password-input">
                                                <input type="password"
                                                       id="customApiKey"
                                                       name="customApiKey"
                                                       value="<%= config.CUSTOM_API_KEY %>"
                                                       class="modern-input">
                                                <button type="button" class="password-toggle" data-input="customApiKey">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="customModel">Model</label>
                                            <input type="text"
                                                   id="customModel"
                                                   name="customModel"
                                                   value="<%= config.CUSTOM_MODEL %>"
                                                   class="modern-input"
                                                   placeholder="Enter model name">
                                        </div>
                                    </div>


                                    <!-- Azure Settings -->
                                    <div id="azureSettings" class="provider-settings">
                                        <div class="form-group">
                                            <label for="azureEndpoint">Endpoint</label>
                                            <input type="text"
                                                   id="azureEndpoint"
                                                   name="azureEndpoint"
                                                   value="<%= config.AZURE_ENDPOINT %>"
                                                   class="modern-input"
                                                   placeholder="https://api.example.com">
                                        </div>

                                        <div class="form-group">
                                            <label for="azureApiKey">API Key</label>
                                            <div class="password-input">
                                                <input type="password"
                                                       id="azureApiKey"
                                                       name="azureApiKey"
                                                       value="<%= config.AZURE_API_KEY %>"
                                                       class="modern-input">
                                                <button type="button" class="password-toggle" data-input="azureApiKey">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="azureDeploymentName">Deployment</label>
                                            <input type="text"
                                                   id="azureDeploymentName"
                                                   name="azureDeploymentName"
                                                   value="<%= config.AZURE_DEPLOYMENT_NAME %>"
                                                   class="modern-input"
                                                   placeholder="Enter deployment name">
                                        </div>

                                        <div class="form-group">
                                            <label for="azureApiVersion">API Version</label>
                                            <input type="text"
                                                   id="azureApiVersion"
                                                   name="azureApiVersion"
                                                   value="<%= config.AZURE_API_VERSION %>"
                                                   class="modern-input"
                                                   placeholder="Enter API version">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="tokenLimit">Token Limit</label>
                                        <input type="number"
                                               id="tokenLimit"
                                               name="tokenLimit"
                                               value="<%= config.AI_TOKEN_LIMIT %>"
                                               class="modern-input"
                                               placeholder="Enter token limit of model">
                                    </div>

                                    <div class="form-group">
                                        <label for="responseTokens">Response Tokens</label>
                                        <input type="number"
                                               id="responseTokens"
                                               name="responseTokens"
                                               value="<%= config.AI_RESPONSE_TOKENS %>"
                                               class="modern-input"
                                               placeholder="Enter approximate token amount for the response">
                                    </div>

                                    <div class="form-group">
                                        <label for="contentSourceMode">Content Source Mode</label>
                                        <select id="contentSourceMode"
                                                name="contentSourceMode"
                                                class="modern-input">
                                            <option value="content" <%= config.AI_CONTENT_SOURCE_MODE === 'content' ? 'selected' : '' %>>Content only (default)</option>
                                            <option value="raw_document" <%= config.AI_CONTENT_SOURCE_MODE === 'raw_document' ? 'selected' : '' %>>Raw document only</option>
                                            <option value="both" <%= config.AI_CONTENT_SOURCE_MODE === 'both' ? 'selected' : '' %>>Both</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="rawDocumentMode">Raw Document Mode</label>
                                        <select id="rawDocumentMode"
                                                name="rawDocumentMode"
                                                class="modern-input">
                                            <option value="text" <%= config.AI_RAW_DOCUMENT_MODE === 'text' ? 'selected' : '' %>>Text (base64)</option>
                                            <option value="file" <%= config.AI_RAW_DOCUMENT_MODE === 'file' ? 'selected' : '' %>>File</option>
                                            <option value="image" <%= config.AI_RAW_DOCUMENT_MODE === 'image' ? 'selected' : '' %>>Image</option>
                                        </select>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Advanced Settings Tab -->
                        <div id="advanced-tab" class="tab-content hidden">
                            <section>
                                <h2 class="section-title">
                                    <i class="fas fa-cog"></i>
                                    Advanced Settings
                                </h2>
                                <div class="space-y-6">
                                    <!-- Basic Settings -->
                                    <div class="form-group">
                                        <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                            <label class="flex items-start cursor-pointer w-full">
                                                <input type="checkbox"
                                                       id="useExistingData"
                                                       class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                       <%= config.AI_USE_EXISTING_DATA ? 'checked' : '' %>>
                                                <div class="ml-3">
                                                    <div class="flex items-center font-medium">
                                                        <i class="fas fa-database text-blue-500 mr-2"></i>
                                                        Use existing Correspondents and Tags
                                                    </div>
                                                    <p class="text-sm text-gray-500 mt-1">Prefer existing metadata before creating new entries</p>
                                                </div>
                                            </label>
                                            <input type="hidden"
                                                   id="useExistingDataValue"
                                                   name="useExistingData"
                                                   value="<%= config.AI_USE_EXISTING_DATA ? 'true' : 'false' %>">
                                        </div>
                                    </div>

                                        <div class="form-group">
                                            <label for="scanInterval">Scan Interval (Cron Format)</label>
                                            <input type="text"
                                                   id="scanInterval"
                                                   name="scanInterval"
                                                   value="<%= config.SCAN_INTERVAL %>"
                                                   class="modern-input"
                                                   required>
                                            <p class="help-text">Default: every 30 minutes</p>
                                        </div>

                                        <div class="form-group">
                                            <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                <label class="flex items-start cursor-pointer w-full">
                                                    <input type="checkbox"
                                                           id="showTags"
                                                           class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                           <%= config.PROCESS_PREDEFINED_DOCUMENTS ? 'checked' : '' %>>
                                                    <div class="ml-3">
                                                        <div class="flex items-center font-medium">
                                                            <i class="fas fa-filter text-blue-500 mr-2"></i>
                                                            Process only specific pre tagged documents
                                                        </div>
                                                        <p class="text-sm text-gray-500 mt-1">Limit processing to documents with selected tags</p>
                                                    </div>
                                                </label>
                                                <input type="hidden"
                                                       id="showTagsValue"
                                                       name="showTags"
                                                       value="<%= config.PROCESS_PREDEFINED_DOCUMENTS ? 'true' : 'false' %>">
                                            </div>
                                        </div>

                                        <!-- Tags Input -->
                                        <div id="tagsInputSection" class="<%= config.PROCESS_PREDEFINED_DOCUMENTS ? '' : 'hidden' %>">
                                            <div class="form-group">
                                                <label for="tagInput">Tags</label>
                                                <div class="tag-input-container">
                                                    <input type="text"
                                                        id="tagInput"
                                                        class="modern-input"
                                                        placeholder="Enter a tag and press Enter">
                                                    <button type="button"
                                                            class="material-button add-tag-btn">
                                                        <i class="fas fa-plus"></i>
                                                        Add
                                                    </button>
                                                </div>
                                                <div id="tagsContainer" class="tags-container">
                                                    <% if (config.TAGS && Array.isArray(config.TAGS) && config.TAGS.length > 0) { %>
                                                        <% config.TAGS.forEach(tag => { %>
                                                            <div class="modern-tag fade-in">
                                                                <span><%= tag %></span>
                                                                <button type="button"><i class="fas fa-times"></i></button>
                                                            </div>
                                                        <% }); %>
                                                    <% } %>
                                                </div>
                                                <input type="hidden" id="tags" name="tags" value="<%= Array.isArray(config.TAGS) ? config.TAGS.join(',') : '' %>">
                                            </div>
                                        </div>

                                        <!-- AI Tag identification -->
                                        <hr/>
                                        <div class="form-group">
                                            <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                <label class="flex items-start cursor-pointer w-full">
                                                    <input type="checkbox"
                                                           id="aiProcessedTag"
                                                           class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                           <%= config.ADD_AI_PROCESSED_TAG ? 'checked' : '' %>>
                                                    <div class="ml-3">
                                                        <div class="flex items-center font-medium">
                                                            <i class="fas fa-tag text-blue-500 mr-2"></i>
                                                            Add AI-processed tag to documents
                                                        </div>
                                                        <p class="text-sm text-gray-500 mt-1">Mark documents that were handled by the AI</p>
                                                    </div>
                                                </label>
                                                <input type="hidden"
                                                       id="aiProcessedTagValue"
                                                       name="aiProcessedTag"
                                                       value="<%= config.ADD_AI_PROCESSED_TAG ? 'true' : 'false' %>">
                                            </div>
                                        </div>

                                        <div id="aiTagNameSection" class="<%= config.ADD_AI_PROCESSED_TAG ? '' : 'hidden' %>">
                                            <div class="form-group">
                                                <label for="aiTagName">AI-processed Tag Name</label>
                                                <input type="text"
                                                    id="aiTagName"
                                                    name="aiTagName"
                                                    value="<%= config.AI_PROCESSED_TAG_NAME || 'ai-processed' %>"
                                                    class="modern-input"
                                                    placeholder="ai-processed">
                                                <p class="help-text">This tag will be added to documents after AI processing</p>
                                            </div>
                                        </div>

                                        <hr/>
                                        <div class="form-group">
                                            <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                <label class="flex items-start cursor-pointer w-full">
                                                    <input type="checkbox"
                                                           id="usePromptTags"
                                                           class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                           <%= config.AI_USE_PROMPT_TAGS ? 'checked' : '' %>>
                                                    <div class="ml-3">
                                                        <div class="flex items-center font-medium">
                                                            <i class="fas fa-hashtag text-blue-500 mr-2"></i>
                                                            Use specific tags in prompt
                                                        </div>
                                                        <p class="text-sm text-gray-500 mt-1">Force the AI to use your prompt tag list</p>
                                                    </div>
                                                </label>
                                                <input type="hidden"
                                                       id="usePromptTagsValue"
                                                       name="usePromptTags"
                                                       value="<%= config.AI_USE_PROMPT_TAGS ? 'true' : 'false' %>">
                                            </div>
                                        </div>

                                        <div id="promptTagsSection" class="<%= config.AI_USE_PROMPT_TAGS ? '' : 'hidden' %>">
                                            <div class="form-group">
                                                <label for="promptTagInput">Prompt Tags</label>
                                                <div class="tag-input-container">
                                                    <input type="text"
                                                        id="promptTagInput"
                                                        class="modern-input"
                                                        placeholder="Enter a tag and press Enter">
                                                    <button type="button"
                                                            class="material-button add-prompt-tag-btn">
                                                        <i class="fas fa-plus"></i>
                                                        Add
                                                    </button>
                                                </div>
                                                <div id="promptTagsContainer" class="tags-container">
                                                    <% if (config.AI_PROMPT_TAGS && Array.isArray(config.AI_PROMPT_TAGS) && config.AI_PROMPT_TAGS.length > 0) { %>
                                                        <% config.AI_PROMPT_TAGS.forEach(tag => { %>
                                                            <div class="modern-tag fade-in">
                                                                <span><%= tag %></span>
                                                                <button type="button"><i class="fas fa-times"></i></button>
                                                            </div>
                                                        <% }); %>
                                                    <% } %>
                                                </div>
                                                <input type="hidden" id="promptTags" name="promptTags" value="<%= Array.isArray(config.AI_PROMPT_TAGS) ? config.AI_PROMPT_TAGS.join(',') : '' %>">
                                                <p class="help-text">These tags will be exclusively used in the AI prompt</p>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="form-group">
                                            <label for="disableAutomaticProcessing">Disable automatic processing?</label>
                                            <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                <label class="flex items-start cursor-pointer w-full">
                                                    <input type="checkbox"
                                                        id="disableAutomaticProcessing"
                                                        name="disableAutomaticProcessing"
                                                        class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                        <%= config.DISABLE_AUTOMATIC_PROCESSING ? 'checked' : '' %>>
                                                    <div class="ml-3">
                                                        <div class="flex items-center font-medium">
                                                            <i class="fas fa-tags text-blue-500 mr-2"></i>
                                                            Disable Automatic Processing
                                                        </div>
                                                        <p class="text-sm text-gray-500 mt-1">Determines if the AI will run on its own or every scan is started manually</p>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                        <hr/>
                                        <!-- Limit Functions Section -->
                                        <div class="form-group space-y-4">
                                            <label class="flex items-center gap-2 font-medium">
                                                <i class="fas fa-sliders-h text-blue-500"></i>
                                                Enable/Disable AI Functions
                                            </label>
                                            <p class="text-sm text-gray-500">Select which functions the AI should perform during document analysis</p>

                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateTagging"
                                                            name="activateTagging"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_TAGGING ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-tags text-blue-500 mr-2"></i>
                                                                Tags Assignment
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Automatically assign relevant tags to documents</p>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateCorrespondent"
                                                            name="activateCorrespondent"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_CORRESPONDENT ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-user text-blue-500 mr-2"></i>
                                                                Correspondent Detection
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Identify document senders automatically</p>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateDocumentType"
                                                            name="activateDocumentType"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_DOCUMENT_TYPE ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-file-alt text-blue-500 mr-2"></i>
                                                                Document Type Classification
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Determine the type of document automatically</p>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateTitle"
                                                            name="activateTitle"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_TITLE ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-heading text-blue-500 mr-2"></i>
                                                                Title Generation
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Generate meaningful titles for documents</p>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateDocumentDate"
                                                            name="activateDocumentDate"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_DOCUMENT_DATE ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-calendar-alt text-blue-500 mr-2"></i>
                                                                Document Date Extraction
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Extract the document date (YYYY-MM-DD)</p>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateLanguage"
                                                            name="activateLanguage"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_LANGUAGE ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-language text-blue-500 mr-2"></i>
                                                                Language Detection
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Detect the document language (e.g., de/en)</p>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateContent"
                                                            name="activateContent"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_CONTENT ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-align-left text-blue-500 mr-2"></i>
                                                                Content Update
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Update document content with the AI-optimized text</p>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="modern-card flex-1 p-4 rounded-lg border border-gray-200 hover:border-blue-500 transition-colors duration-200">
                                                    <label class="flex items-start cursor-pointer w-full">
                                                        <input type="checkbox"
                                                            id="activateCustomFields"
                                                            name="activateCustomFields"
                                                            class="mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                                                            <%= config.ACTIVATE_CUSTOM_FIELDS ? 'checked' : '' %>>
                                                        <div class="ml-3">
                                                            <div class="flex items-center font-medium">
                                                                <i class="fas fa-filter text-blue-500 mr-2"></i>
                                                                Custom Fields
                                                            </div>
                                                            <p class="text-sm text-gray-500 mt-1">Add custom fields to the documents</p>
                                                        </div>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <hr/>
                                        <!-- Custom Fields Section -->
                                        <section>
                                            <div class="form-group space-y-4" id="customFieldsSection">
                                                <label class="flex items-center gap-2 font-medium">
                                                    <i class="fas fa-table text-blue-500"></i>
                                                    Custom Fields Configuration
                                                </label>
                                                <p class="text-sm text-gray-500">Configure custom fields that will be populated by AI during document analysis.</p>

                                                <!-- Fields Container -->
                                                <div id="customFieldsList" class="space-y-2">
                                                    <% if (config.AI_CUSTOM_FIELDS && Array.isArray(JSON.parse(config.AI_CUSTOM_FIELDS).custom_fields)) { %>
                                                        <% JSON.parse(config.AI_CUSTOM_FIELDS).custom_fields.forEach((field, index) => { %>
                                                            <div class="custom-field-item flex items-center gap-2 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-200 transition-colors">
                                                                <div class="cursor-move text-gray-400">
                                                                    <i class="fas fa-grip-vertical"></i>
                                                                </div>
                                                                <div class="flex-1 flex items-center gap-4">
                                                                    <div class="flex-1">
                                                                        <p class="font-medium"><%= field.value %></p>
                                                                        <p class="text-sm text-gray-500">
                                                                            Type: <%= field.data_type %>
                                                                            <% if (field.data_type === 'monetary' && field.currency) { %>
                                                                                (<%= field.currency %>)
                                                                            <% } %>
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button type="button"
                                                                    onclick="removeCustomField(this)"
                                                                    class="text-gray-400 hover:text-red-500 transition-colors">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    <% }); %>
                                                <% } %>
                                            </div>

                                            <!-- Add New Field Form -->
                                            <div class="grid grid-cols-12 gap-3 mt-4">
                                                <div class="col-span-6">
                                                    <input type="text"
                                                        id="newFieldName"
                                                        class="modern-input w-full"
                                                        placeholder="Enter field name...">
                                                </div>

                                                <div class="col-span-2">
                                                    <select id="newFieldType" class="modern-input w-full" onchange="toggleCurrencySelect()">
                                                        <option value="string">Text</option>
                                                        <option value="float">Number</option>
                                                        <option value="integer">Integer</option>
                                                        <option value="boolean">Boolean</option>
                                                        <option value="date">Date</option>
                                                        <option value="monetary">Currency</option>
                                                        <option value="url">URL</option>
                                                    </select>
                                                </div>

                                                <div class="col-span-2">
                                                    <select id="currencyCode" class="modern-input w-full hidden">
                                                        <option value="EUR">EUR</option>
                                                        <option value="USD">USD</option>
                                                        <option value="GBP">GBP</option>
                                                        <option value="JPY">JPY</option>
                                                        <option value="CHF">CHF</option>
                                                        <option value="AUD">AUD</option>
                                                        <option value="CAD">CAD</option>
                                                        <option value="CNY">CNY</option>
                                                        <option value="INR">INR</option>
                                                        <option value="NZD">NZD</option>
                                                    </select>
                                                </div>

                                                <div class="col-span-2">
                                                    <button type="button"
                                                            onclick="addCustomField()"
                                                            class="material-button w-full flex items-center justify-center gap-2"
                                                            id="addFieldBtn">
                                                        <i class="fas fa-plus"></i>
                                                        Add
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Hidden input for form submission -->
                                            <input type="hidden"
                                                id="customFieldsJson"
                                                name="customFields"
                                                value="<%= config.AI_CUSTOM_FIELDS || '{"custom_fields":[]}' %>">
                                        </div>
                                    </section>

                                    <hr/>
                                    <!-- System Prompt -->
                                    <div class="form-group">
                                        <label for="systemPrompt">Prompt Description</label>
                                        <div class="prompt-container">
                                            <textarea id="systemPrompt"
                                                     name="systemPrompt"
                                                     rows="8"
                                                     class="modern-input"
                                                     placeholder="Describe how the AI should analyze your documents..."><%= config.AI_SYSTEM_PROMPT %></textarea>
                                            <button id="systemPromptBtn" type="button"
                                                    class="material-button example-btn">
                                                <i class="fas fa-lightbulb"></i>
                                                Example
                                            </button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="mustHavePrompt">Must-Have-Prompt (<em>(only appended, if placeholder <code>%JSON_SCHEMA%</code> is not present in Prompt above)</em>)</label>
                                        <textarea id="mustHavePrompt"
                                                  name="mustHavePrompt"
                                                  rows="6"
                                                  class="modern-input"
                                                  placeholder="mandatory appendix defined in application configuration"
                                                  disabled><%= config.ai?.mustHavePrompt || '' %></textarea>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex justify-between pt-6">
                            <button type="button" id="prevBtn" class="material-button hidden">
                                <i class="fas fa-arrow-left"></i>
                                Previous
                            </button>
                            <button type="button" id="nextBtn" class="material-button">
                                Next
                                <i class="fas fa-arrow-right"></i>
                            </button>
                            <button type="submit" id="submitBtn" class="material-button submit-btn hidden">
                                <i class="fas fa-save"></i>
                                Save Configuration
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/theme-manager.js"></script>
    <script src="js/setup.js"></script>
    <script src="js/setup-extra.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- <script src="https://cdn.jsdelivr.net/npm/shepherd.js/dist/js/shepherd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js/dist/css/shepherd.css"> -->
</body>
</html>
